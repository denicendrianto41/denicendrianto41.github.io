<!doctype html>
<html lang="id" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Make A Match - Organ Systems</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      overflow: hidden;
    }
    * {
      font-family: 'Fredoka', sans-serif;
    }
    .card-flip {
      perspective: 1000px;
    }
    .card-inner {
      transition: transform 0.5s;
      transform-style: preserve-3d;
      position: relative;
      width: 100%;
      height: 100%;
    }
    .card-inner.flipped {
      transform: rotateY(180deg);
    }
    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
    }
    .card-back {
      transform: rotateY(180deg);
    }
    .matched {
      animation: matchPulse 0.5s ease;
    }
    @keyframes matchPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    .confetti {
      position: absolute;
      width: 8px;
      height: 8px;
      animation: confettiFall 2s ease-out forwards;
    }
    @keyframes confettiFall {
      0% { transform: translateY(-100%) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
    .sound-toggle {
      position: fixed;
      bottom: 10px;
      right: 10px;
      z-index: 50;
    }
    /* Animasi ucapan selamat level */
    .level-congrats {
      animation: levelCongrats 2.5s ease forwards;
      z-index: 100;
      pointer-events: none;
    }
    @keyframes levelCongrats {
      0% {
        transform: scale(0) translateY(50px);
        opacity: 0;
      }
      15% {
        transform: scale(1.05) translateY(0);
        opacity: 1;
      }
      85% {
        transform: scale(1) translateY(0);
        opacity: 1;
      }
      100% {
        transform: scale(0) translateY(-50px);
        opacity: 0;
      }
    }
    /* Animasi applause */
    .applause-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .applause-container {
      text-align: center;
      animation: applauseScale 0.6s ease-out;
    }
    @keyframes applauseScale {
      0% { transform: scale(0.3); opacity: 0; }
      70% { transform: scale(1.05); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }
    .applause-text {
      font-size: 2rem;
      font-weight: 800;
      color: #FFD700;
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
      animation: textGlow 1.5s ease-in-out infinite alternate;
      margin-bottom: 10px;
    }
    @keyframes textGlow {
      from { 
        text-shadow: 0 0 10px rgba(255, 215, 0, 0.7), 
                     0 0 20px rgba(255, 215, 0, 0.5); 
      }
      to { 
        text-shadow: 0 0 20px rgba(255, 215, 0, 0.9), 
                     0 0 30px rgba(255, 215, 0, 0.7),
                     0 0 40px rgba(255, 215, 0, 0.5); 
      }
    }
    
    /* Custom card styles */
    .card-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      padding: 4px;
      text-align: center;
    }
    
    .card-icon {
      margin-bottom: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .card-text {
      line-height: 1;
      font-weight: 600;
      word-break: break-word;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      text-overflow: ellipsis;
    }
    
    /* Grid responsive untuk kartu */
    .game-board {
      display: grid;
      gap: 4px;
      padding: 2px;
      overflow: auto;
    }
    
    /* Custom scrollbar untuk game board */
    .game-board::-webkit-scrollbar {
      width: 4px;
      height: 4px;
    }
    
    .game-board::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 2px;
    }
    
    .game-board::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 2px;
    }
    
    .game-board::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.5);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
</head>
<body class="h-full">
<div id="app" class="h-full w-full overflow-hidden" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);">
  
  <!-- Level Congratulation Modal -->
  <div id="levelCongratsModal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
    <div class="absolute inset-0 bg-black/70 backdrop-blur-sm"></div>
    <div class="level-congrats relative bg-gradient-to-r from-yellow-400 via-yellow-300 to-yellow-400 p-4 rounded-xl shadow-2xl border-3 border-yellow-500 max-w-xs mx-3">
      <div class="text-center">
        <div class="text-4xl mb-2 animate-bounce">üèÜ</div>
        <h3 class="text-xl font-bold text-gray-800 mb-1">HEBAT!</h3>
        <p id="levelWinnerName" class="text-lg font-bold text-purple-700 mb-1"></p>
        <p class="text-sm text-gray-700 mb-2">Pertama selesai!</p>
        <div class="flex items-center justify-center gap-1 text-base text-gray-800">
          <span>‚≠ê</span>
          <span id="levelDifficultyText" class="font-bold"></span>
          <span>‚≠ê</span>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Applause Animation Overlay -->
  <div id="applauseOverlay" class="applause-overlay hidden">
    <div class="applause-container">
      <div class="text-6xl mb-3">üëèüéâ‚ú®</div>
      <div id="applauseText" class="applause-text"></div>
      <div class="text-xl text-white font-semibold mt-2" id="applauseSubtext">Juara Level!</div>
    </div>
  </div>
  
  <!-- Sound Toggle Button -->
  <button onclick="toggleSound()" id="soundToggle" class="sound-toggle bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white px-3 py-2 rounded-full shadow-lg transition-all transform hover:scale-110 flex items-center gap-1 text-sm">
    <span id="soundIcon">üîä</span>
  </button>
  
  <!-- Start Screen -->
  <div id="startScreen" class="h-full flex flex-col items-center justify-center p-3 overflow-auto">
    <div class="text-center mb-4">
      <h1 id="gameTitle" class="text-2xl md:text-3xl font-bold text-white mb-2 drop-shadow-lg">üß¨ Make A Match</h1>
      <p class="text-base text-cyan-300">Sistem Organ Manusia</p>
      <p class="text-gray-300 text-xs mt-1">Cocokkan organ dengan sistemnya!</p>
    </div>
    
    <!-- Player Names -->
    <div class="bg-white/10 backdrop-blur-sm rounded-lg p-3 mb-3 w-full max-w-xs">
      <h3 class="text-white font-semibold mb-2 text-center text-sm">üë• Nama Pemain</h3>
      <div class="space-y-2">
        <div class="flex items-center gap-2">
          <span class="text-lg">üîµ</span>
          <input type="text" id="player1Name" placeholder="Pemain 1" maxlength="10" class="flex-1 px-3 py-1.5 rounded bg-white/20 text-white placeholder-gray-300 border border-cyan-500/50 focus:border-cyan-400 focus:outline-none text-sm">
        </div>
        <div class="flex items-center gap-2">
          <span class="text-lg">üü†</span>
          <input type="text" id="player2Name" placeholder="Pemain 2" maxlength="10" class="flex-1 px-3 py-1.5 rounded bg-white/20 text-white placeholder-gray-300 border border-pink-500/50 focus:border-pink-400 focus:outline-none text-sm">
        </div>
      </div>
    </div>
    
    <!-- Difficulty Selection -->
    <div class="bg-white/10 backdrop-blur-sm rounded-lg p-3 mb-3 w-full max-w-xs">
      <h3 class="text-white font-semibold mb-2 text-center text-sm">üéÆ Tingkat Kesulitan</h3>
      <div class="grid grid-cols-3 gap-1">
        <button onclick="selectDifficulty('easy')" id="btnEasy" class="difficulty-btn bg-green-500 hover:bg-green-400 text-white py-1.5 px-1 rounded font-semibold transition-all transform hover:scale-105 border-b-3 border-green-700">
          <span class="text-lg block mb-0.5">üå±</span>
          <span class="text-xs">Mudah</span>
          <span class="text-[10px] block opacity-80">5 pasang</span>
        </button>
        <button onclick="selectDifficulty('medium')" id="btnMedium" class="difficulty-btn bg-yellow-500 hover:bg-yellow-400 text-white py-1.5 px-1 rounded font-semibold transition-all transform hover:scale-105 border-b-3 border-yellow-700">
          <span class="text-lg block mb-0.5">üåø</span>
          <span class="text-xs">Sedang</span>
          <span class="text-[10px] block opacity-80">8 pasang</span>
        </button>
        <button onclick="selectDifficulty('hard')" id="btnHard" class="difficulty-btn bg-red-500 hover:bg-red-400 text-white py-1.5 px-1 rounded font-semibold transition-all transform hover:scale-105 border-b-3 border-red-700">
          <span class="text-lg block mb-0.5">üå≥</span>
          <span class="text-xs">Sulit</span>
          <span class="text-[10px] block opacity-80">10 pasang</span>
        </button>
      </div>
    </div>
    
    <button onclick="startGame()" id="startBtn" class="bg-gradient-to-r from-cyan-500 to-blue-600 text-white font-bold py-2 px-6 rounded-lg transition-all transform hover:scale-105 shadow-lg text-sm mb-3">
      üöÄ Mulai Game
    </button>
    
    <!-- Instructions -->
    <div class="text-center text-gray-300 text-[10px] max-w-xs">
      <p class="mb-1">üìã <strong class="text-white">Cara Main:</strong> Temukan pasangan kartu yang cocok!</p>
    </div>
  </div>
  
  <!-- Game Screen -->
  <div id="gameScreen" class="h-full flex flex-col p-1.5 hidden">
    <!-- Header -->
    <div class="flex justify-between items-center mb-1.5 gap-1">
      <button onclick="backToMenu()" class="bg-white/20 hover:bg-white/30 text-white px-2 py-1 rounded transition-all flex items-center gap-0.5 text-xs">
        ‚Üê Menu
      </button>
      <div class="flex items-center gap-1 bg-white/10 px-2 py-1 rounded">
        <span class="text-yellow-300 text-xs">‚è±Ô∏è</span>
        <span id="timer" class="text-white font-mono text-sm">00:00</span>
      </div>
    </div>
    
    <!-- Score Board Compact -->
    <div class="grid grid-cols-2 gap-1.5 mb-1.5">
      <div id="player1Card" class="bg-gradient-to-r from-cyan-600 to-cyan-500 p-1.5 rounded text-white transition-all">
        <div class="flex items-center gap-1.5">
          <span class="text-lg">üîµ</span>
          <div class="flex-1 min-w-0">
            <p id="p1NameDisplay" class="font-bold text-xs truncate">Pemain 1</p>
            <div class="flex items-center gap-0.5">
              <span class="text-cyan-200 text-[10px]">Skor:</span>
              <span id="p1Score" class="text-base font-bold">0</span>
            </div>
          </div>
        </div>
      </div>
      <div id="player2Card" class="bg-gradient-to-r from-pink-600 to-pink-500 p-1.5 rounded text-white transition-all opacity-60">
        <div class="flex items-center gap-1.5">
          <span class="text-lg">üü†</span>
          <div class="flex-1 min-w-0">
            <p id="p2NameDisplay" class="font-bold text-xs truncate">Pemain 2</p>
            <div class="flex items-center gap-0.5">
              <span class="text-pink-200 text-[10px]">Skor:</span>
              <span id="p2Score" class="text-base font-bold">0</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Competitive Status Bar Compact -->
    <div class="grid grid-cols-2 gap-1.5 mb-1.5">
      <div class="bg-gradient-to-r from-cyan-500/30 to-cyan-600/20 rounded p-1.5 border border-cyan-400/50">
        <div class="flex items-center justify-between mb-1">
          <span class="text-white font-semibold text-[10px]">Kecocokan:</span>
          <span id="p1Matches" class="text-cyan-300 font-bold text-xs">0/<span id="totalMatches">5</span></span>
        </div>
        <div class="bg-cyan-900/30 rounded-full h-1 overflow-hidden">
          <div id="p1MatchBar" class="h-full bg-gradient-to-r from-cyan-400 to-cyan-300 transition-all duration-300" style="width: 0%"></div>
        </div>
      </div>
      <div class="bg-gradient-to-r from-pink-500/30 to-pink-600/20 rounded p-1.5 border border-pink-400/50">
        <div class="flex items-center justify-between mb-1">
          <span class="text-white font-semibold text-[10px]">Kecocokan:</span>
          <span id="p2Matches" class="text-pink-300 font-bold text-xs">0/<span id="totalMatches2">5</span></span>
        </div>
        <div class="bg-pink-900/30 rounded-full h-1 overflow-hidden">
          <div id="p2MatchBar" class="h-full bg-gradient-to-r from-pink-400 to-pink-300 transition-all duration-300" style="width: 0%"></div>
        </div>
      </div>
    </div>
    
    <!-- Split Screen Game Board Compact -->
    <div class="flex-1 grid grid-cols-2 gap-1.5 min-h-0 overflow-hidden">
      <!-- Player 1 Board -->
      <div class="flex flex-col bg-gradient-to-b from-cyan-600/20 to-cyan-400/10 rounded p-1 border border-cyan-500/30 overflow-hidden">
        <h3 class="text-cyan-300 font-bold text-center mb-0.5 text-xs truncate">üîµ <span id="p1BoardName">P1</span></h3>
        <div id="gameBoard1" class="game-board flex-1">
          <!-- Cards will be generated here -->
        </div>
      </div>
      
      <!-- Player 2 Board -->
      <div class="flex flex-col bg-gradient-to-b from-pink-600/20 to-pink-400/10 rounded p-1 border border-pink-500/30 overflow-hidden">
        <h3 class="text-pink-300 font-bold text-center mb-0.5 text-xs truncate">üü† <span id="p2BoardName">P2</span></h3>
        <div id="gameBoard2" class="game-board flex-1">
          <!-- Cards will be generated here -->
        </div>
      </div>
    </div>
    
    <!-- Info Panel Compact -->
    <div id="infoPanel" class="mt-1 bg-white/10 backdrop-blur-sm rounded p-1.5 text-center hidden">
      <p id="infoText" class="text-white text-xs"></p>
    </div>
  </div>
  
  <!-- Result Screen Compact -->
  <div id="resultScreen" class="h-full w-full flex flex-col items-center justify-center p-2 fixed inset-0 hidden z-50 overflow-auto" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);">
    <div id="confettiContainer" class="absolute inset-0 overflow-hidden pointer-events-none"></div>
    <div class="text-center z-30 w-full flex flex-col items-center justify-center max-w-sm px-2 py-3">
      
      <!-- Winner Announcement -->
      <div class="mb-3 flex justify-center">
        <span class="text-5xl block animate-bounce">üéä</span>
      </div>
      
      <div id="winnerAnnouncement" class="mb-3 bg-gradient-to-r from-yellow-400/20 to-yellow-500/20 border border-yellow-400/50 rounded-lg p-2.5 w-full">
        <p id="winnerMessageLevel" class="text-base text-yellow-300 font-bold mb-0.5"></p>
        <p class="text-sm text-white font-semibold">Pemenang! üèÖ</p>
      </div>
      
      <h2 class="text-xl font-bold text-white mb-1 drop-shadow-lg">SELAMAT!</h2>
      <p id="winnerName" class="text-2xl font-bold bg-gradient-to-r from-yellow-300 to-yellow-500 bg-clip-text text-transparent mb-2 px-2 drop-shadow-lg truncate w-full"></p>
      
      <!-- Results Card Compact -->
      <div class="bg-white/15 backdrop-blur-sm rounded-xl p-3 mb-3 w-full border border-white/20 shadow-lg">
        <h3 class="text-base text-white font-bold mb-2 pb-1.5 border-b border-white/20">üìä Hasil Game</h3>
        <div class="space-y-1.5 mb-2.5">
          <!-- Player 1 Result -->
          <div class="flex justify-between items-center bg-gradient-to-r from-cyan-500/50 to-cyan-600/30 p-1.5 rounded-lg border border-cyan-400/70">
            <div class="flex items-center gap-1.5">
              <span class="text-xl">üîµ</span>
              <span id="result1Name" class="text-white font-bold text-sm truncate max-w-[100px]"></span>
            </div>
            <span id="result1Score" class="text-lg font-bold text-cyan-200 bg-cyan-900/40 px-1.5 py-0.5 rounded"></span>
          </div>
          
          <!-- Player 2 Result -->
          <div class="flex justify-between items-center bg-gradient-to-r from-pink-500/50 to-pink-600/30 p-1.5 rounded-lg border border-pink-400/70">
            <div class="flex items-center gap-1.5">
              <span class="text-xl">üü†</span>
              <span id="result2Name" class="text-white font-bold text-sm truncate max-w-[100px]"></span>
            </div>
            <span id="result2Score" class="text-lg font-bold text-pink-200 bg-pink-900/40 px-1.5 py-0.5 rounded"></span>
          </div>
        </div>
        
        <!-- Stats Grid Compact -->
        <div class="grid grid-cols-2 gap-1.5 pt-2 border-t border-white/20">
          <div class="flex flex-col items-center bg-white/10 rounded p-1.5">
            <span class="text-lg mb-0.5">‚è±Ô∏è</span>
            <span class="text-gray-300 text-[10px] font-medium">Waktu</span>
            <span id="resultTime" class="font-mono text-sm font-bold text-yellow-300 mt-0.5"></span>
          </div>
          <div class="flex flex-col items-center bg-white/10 rounded p-1.5">
            <span class="text-lg mb-0.5">üéØ</span>
            <span class="text-gray-300 text-[10px] font-medium">Level</span>
            <span id="resultDifficulty" class="text-sm font-bold text-yellow-300 mt-0.5"></span>
          </div>
        </div>
      </div>
      
      <!-- Action Buttons Compact -->
      <div class="flex flex-col gap-1.5 justify-center w-full">
        <button onclick="restartGame()" class="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-2 px-3 rounded-lg transition-all transform hover:scale-105 active:scale-95 shadow hover:shadow-green-600/50 border border-green-300/50 text-xs flex items-center justify-center gap-1">
          <span class="text-lg">üîÑ</span>
          Main Lagi
        </button>
        <button onclick="backToMenu()" class="bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-bold py-2 px-3 rounded-lg transition-all transform hover:scale-105 active:scale-95 shadow hover:shadow-blue-600/50 border border-blue-300/50 text-xs flex items-center justify-center gap-1">
          <span class="text-lg">üìã</span>
          Menu Utama
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  // Sound Effects using Web Audio API
  const soundManager = {
    audioContext: null,
    soundEnabled: true,
    
    init() {
      this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
    },
    
    playFlipSound() {
      if (!this.soundEnabled) return;
      if (!this.audioContext) this.init();
      const ctx = this.audioContext;
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      
      osc.connect(gain);
      gain.connect(ctx.destination);
      
      osc.frequency.setValueAtTime(450, ctx.currentTime);
      osc.frequency.setValueAtTime(550, ctx.currentTime + 0.08);
      gain.gain.setValueAtTime(0.2, ctx.currentTime);
      gain.gain.setValueAtTime(0, ctx.currentTime + 0.08);
      
      osc.start(ctx.currentTime);
      osc.stop(ctx.currentTime + 0.08);
    },
    
    playMatchSound() {
      if (!this.soundEnabled) return;
      if (!this.audioContext) this.init();
      const ctx = this.audioContext;
      const notes = [523.25, 659.25, 783.99];
      
      notes.forEach((freq, i) => {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        
        osc.connect(gain);
        gain.connect(ctx.destination);
        
        osc.frequency.setValueAtTime(freq, ctx.currentTime);
        gain.gain.setValueAtTime(0.15, ctx.currentTime + i * 0.08);
        gain.gain.setValueAtTime(0, ctx.currentTime + i * 0.08 + 0.12);
        
        osc.start(ctx.currentTime + i * 0.08);
        osc.stop(ctx.currentTime + i * 0.08 + 0.12);
      });
    },
    
    playMissSound() {
      if (!this.soundEnabled) return;
      if (!this.audioContext) this.init();
      const ctx = this.audioContext;
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      
      osc.connect(gain);
      gain.connect(ctx.destination);
      
      osc.frequency.setValueAtTime(280, ctx.currentTime);
      osc.frequency.setValueAtTime(180, ctx.currentTime + 0.15);
      gain.gain.setValueAtTime(0.2, ctx.currentTime);
      gain.gain.setValueAtTime(0, ctx.currentTime + 0.15);
      
      osc.start(ctx.currentTime);
      osc.stop(ctx.currentTime + 0.15);
    },
    
    playWinSound() {
      if (!this.soundEnabled) return;
      if (!this.audioContext) this.init();
      const ctx = this.audioContext;
      const notes = [523.25, 659.25, 783.99, 1046.5];
      
      notes.forEach((freq, i) => {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        
        osc.connect(gain);
        gain.connect(ctx.destination);
        
        osc.frequency.setValueAtTime(freq, ctx.currentTime);
        gain.gain.setValueAtTime(0.2, ctx.currentTime + i * 0.12);
        gain.gain.setValueAtTime(0, ctx.currentTime + i * 0.12 + 0.15);
        
        osc.start(ctx.currentTime + i * 0.12);
        osc.stop(ctx.currentTime + i * 0.12 + 0.15);
      });
    },
    
    playButtonClick() {
      if (!this.soundEnabled) return;
      if (!this.audioContext) this.init();
      const ctx = this.audioContext;
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      
      osc.connect(gain);
      gain.connect(ctx.destination);
      
      osc.frequency.setValueAtTime(800, ctx.currentTime);
      osc.frequency.setValueAtTime(850, ctx.currentTime + 0.04);
      gain.gain.setValueAtTime(0.15, ctx.currentTime);
      gain.gain.setValueAtTime(0, ctx.currentTime + 0.04);
      
      osc.start(ctx.currentTime);
      osc.stop(ctx.currentTime + 0.04);
    },
    
    playLevelCompleteSound() {
      if (!this.soundEnabled) return;
      if (!this.audioContext) this.init();
      const ctx = this.audioContext;
      const notes = [659.25, 830.61, 987.77, 1174.66];
      
      notes.forEach((freq, i) => {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        
        osc.connect(gain);
        gain.connect(ctx.destination);
        
        osc.frequency.setValueAtTime(freq, ctx.currentTime);
        gain.gain.setValueAtTime(0.25, ctx.currentTime + i * 0.1);
        gain.gain.setValueAtTime(0, ctx.currentTime + i * 0.1 + 0.25);
        
        osc.start(ctx.currentTime + i * 0.1);
        osc.stop(ctx.currentTime + i * 0.1 + 0.25);
      });
    },
    
    playApplauseSound() {
      if (!this.soundEnabled) return;
      if (!this.audioContext) this.init();
      const ctx = this.audioContext;
      
      // Create applause effect
      for (let i = 0; i < 3; i++) {
        setTimeout(() => {
          const notes = [392, 440, 494, 523];
          notes.forEach((freq, j) => {
            setTimeout(() => {
              const osc = ctx.createOscillator();
              const gain = ctx.createGain();
              
              osc.connect(gain);
              gain.connect(ctx.destination);
              
              osc.frequency.setValueAtTime(freq, ctx.currentTime);
              gain.gain.setValueAtTime(0.12, ctx.currentTime);
              gain.gain.setValueAtTime(0, ctx.currentTime + 0.25);
              
              osc.start(ctx.currentTime);
              osc.stop(ctx.currentTime + 0.25);
            }, j * 40);
          });
        }, i * 150);
      }
    }
  };

  function toggleSound() {
    soundManager.soundEnabled = !soundManager.soundEnabled;
    const toggle = document.getElementById('soundToggle');
    const icon = document.getElementById('soundIcon');
    
    if (soundManager.soundEnabled) {
      icon.textContent = 'üîä';
      toggle.classList.remove('from-gray-500', 'to-gray-600');
      toggle.classList.add('from-green-500', 'to-emerald-600');
    } else {
      icon.textContent = 'üîá';
      toggle.classList.remove('from-green-500', 'to-emerald-600');
      toggle.classList.add('from-gray-500', 'to-gray-600');
    }
  }

  // Game Data dengan nama yang lebih pendek
  const organData = {
    circulatory: {
      name: "Sirkulasi Darah",
      icon: "‚ù§Ô∏è",
      color: "from-red-500 to-rose-600",
      cardFrontIcon: "üíì",
      organs: [
        { name: "Jantung", icon: "‚ù§Ô∏è", function: "Memompa darah" },
        { name: "Arteri", icon: "ü©∏", function: "Alirkan darah" },
        { name: "Vena", icon: "üîÑ", function: "Bawa darah" },
        { name: "Kapiler", icon: "ü©∏", function: "Tukar zat" },
        { name: "Sel Darah", icon: "üî¥", function: "Angkut O2" },
        { name: "Trombosit", icon: "ü©π", function: "Bekuan" },
        { name: "Plasma", icon: "üíß", function: "Transport" },
        { name: "Atrium", icon: "üè†", function: "Terima darah" },
        { name: "Ventrikel", icon: "üöÄ", function: "Pompa darah" },
        { name: "Vena Kava", icon: "üîÑ", function: "Darah balik" }
      ]
    },
    excretory: {
      name: "Ekskresi",
      icon: "üíß",
      color: "from-yellow-500 to-amber-600",
      cardFrontIcon: "üöΩ",
      organs: [
        { name: "Ginjal", icon: "ü´ò", function: "Saring darah" },
        { name: "Ureter", icon: "üìç", function: "Salur urine" },
        { name: "Kandung Kemih", icon: "üí¶", function: "Tampung urine" },
        { name: "Uretra", icon: "üöø", function: "Keluar urine" },
        { name: "Kulit", icon: "ü§ö", function: "Keringat" },
        { name: "Paru-paru", icon: "ü´Å", function: "CO2" },
        { name: "Hati", icon: "üçÉ", function: "Detoks" },
        { name: "Nefron", icon: "üî¨", function: "Penyaring" },
        { name: "Kelenjar", icon: "üí®", function: "Keringat" },
        { name: "Empedu", icon: "üü¢", function: "Pencernaan" }
      ]
    },
    coordination: {
      name: "Koordinasi",
      icon: "üß†",
      color: "from-purple-500 to-violet-600",
      cardFrontIcon: "‚ö°",
      organs: [
        { name: "Otak", icon: "üß†", function: "Kendali" },
        { name: "Serebrum", icon: "üéØ", function: "Pikiran" },
        { name: "Serebelum", icon: "‚öñÔ∏è", function: "Seimbang" },
        { name: "Batang Otak", icon: "üå≥", function: "Nafas" },
        { name: "Sumsum", icon: "ü¶¥", function: "Impuls" },
        { name: "Saraf", icon: "‚ö°", function: "Hubung" },
        { name: "Mata", icon: "üëÅÔ∏è", function: "Lihat" },
        { name: "Telinga", icon: "üëÇ", function: "Dengar" },
        { name: "Lidah", icon: "üëÖ", function: "Rasa" },
        { name: "Hipofisis", icon: "üéõÔ∏è", function: "Hormon" }
      ]
    }
  };

  // Game State
  let gameState = {
    difficulty: null,
    players: [
      { name: "Pemain 1", score: 0 },
      { name: "Pemain 2", score: 0 }
    ],
    timer: 0,
    timerInterval: null,
    targetPairs: 0,
    player1State: {
      matchedPairs: 0,
      flippedCards: [],
      isLocked: false
    },
    player2State: {
      matchedPairs: 0,
      flippedCards: [],
      isLocked: false
    },
    firstLevelCompletion: false,
    isShowingApplause: false
  };

  const defaultConfig = {
    game_title: "Make A Match"
  };
  let config = { ...defaultConfig };

  if (window.elementSdk) {
    window.elementSdk.init({
      defaultConfig,
      onConfigChange: async (newConfig) => {
        config = { ...defaultConfig, ...newConfig };
        document.getElementById('gameTitle').textContent = `üß¨ ${config.game_title}`;
      },
      mapToCapabilities: (config) => ({
        recolorables: [],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      }),
      mapToEditPanelValues: (config) => new Map([
        ["game_title", config.game_title || defaultConfig.game_title]
      ])
    });
  }

  // Fungsi untuk menampilkan animasi ucapan selamat level
  function showLevelCongrats(playerName) {
    const modal = document.getElementById('levelCongratsModal');
    const levelWinnerName = document.getElementById('levelWinnerName');
    const levelDifficultyText = document.getElementById('levelDifficultyText');
    
    levelWinnerName.textContent = playerName;
    
    // Set teks tingkat kesulitan
    let diffText = '';
    switch(gameState.difficulty) {
      case 'easy': diffText = 'Mudah'; break;
      case 'medium': diffText = 'Sedang'; break;
      case 'hard': diffText = 'Sulit'; break;
      default: diffText = 'Game';
    }
    levelDifficultyText.textContent = diffText;
    
    // Tampilkan modal dan mainkan suara
    modal.classList.remove('hidden');
    soundManager.playLevelCompleteSound();
    
    // Otomatis sembunyikan setelah 2.5 detik
    setTimeout(() => {
      modal.classList.add('hidden');
    }, 2500);
  }

  // Fungsi untuk menampilkan animasi applause
  function showApplause(playerName) {
    if (gameState.isShowingApplause) return;
    
    gameState.isShowingApplause = true;
    const overlay = document.getElementById('applauseOverlay');
    const applauseText = document.getElementById('applauseText');
    
    // Potong nama jika terlalu panjang
    const shortName = playerName.length > 10 ? playerName.substring(0, 8) + "..." : playerName;
    applauseText.textContent = `${shortName.toUpperCase()}!`;
    
    // Tampilkan overlay
    overlay.classList.remove('hidden');
    
    // Mainkan suara applause
    soundManager.playApplauseSound();
    
    // Sembunyikan setelah 3 detik
    setTimeout(() => {
      overlay.classList.add('hidden');
      gameState.isShowingApplause = false;
    }, 3000);
  }

  function selectDifficulty(level) {
    soundManager.playButtonClick();
    gameState.difficulty = level;
    
    document.querySelectorAll('.difficulty-btn').forEach(btn => {
      btn.classList.remove('ring-1', 'ring-white');
    });
    
    const btnId = level === 'easy' ? 'btnEasy' : level === 'medium' ? 'btnMedium' : 'btnHard';
    document.getElementById(btnId).classList.add('ring-1', 'ring-white');
  }

  function generateCards() {
    const cards = [];
    let pairsNeeded;
    
    switch(gameState.difficulty) {
      case 'easy': pairsNeeded = 5; break;
      case 'medium': pairsNeeded = 8; break;
      case 'hard': pairsNeeded = 10; break;
      default: pairsNeeded = 5;
    }
    
    gameState.targetPairs = pairsNeeded;
    
    const allOrgans = [];
    Object.keys(organData).forEach(systemKey => {
      const system = organData[systemKey];
      system.organs.forEach(organ => {
        allOrgans.push({ organ, system, systemKey });
      });
    });
    
    const shuffled = allOrgans.sort(() => Math.random() - 0.5);
    const selected = shuffled.slice(0, pairsNeeded);
    
    selected.forEach((item, index) => {
      cards.push({
        id: `organ-${index}`,
        type: 'organ',
        pairId: index,
        content: item.organ,
        system: item.system,
        systemKey: item.systemKey
      });
      
      cards.push({
        id: `system-${index}`,
        type: 'system',
        pairId: index,
        content: item.organ,
        system: item.system,
        systemKey: item.systemKey
      });
    });
    
    return cards.sort(() => Math.random() - 0.5);
  }

  function startGame() {
    soundManager.playButtonClick();
    const p1Name = document.getElementById('player1Name').value.trim() || 'Pemain 1';
    const p2Name = document.getElementById('player2Name').value.trim() || 'Pemain 2';
    
    // Potong nama jika terlalu panjang
    const shortP1Name = p1Name.length > 8 ? p1Name.substring(0, 6) + ".." : p1Name;
    const shortP2Name = p2Name.length > 8 ? p2Name.substring(0, 6) + ".." : p2Name;
    
    gameState.players[0].name = shortP1Name;
    gameState.players[1].name = shortP2Name;
    gameState.players[0].score = 0;
    gameState.players[1].score = 0;
    gameState.timer = 0;
    gameState.firstLevelCompletion = false;
    gameState.isShowingApplause = false;
    
    gameState.player1State = {
      matchedPairs: 0,
      flippedCards: [],
      isLocked: false
    };
    
    gameState.player2State = {
      matchedPairs: 0,
      flippedCards: [],
      isLocked: false
    };
    
    document.getElementById('p1NameDisplay').textContent = shortP1Name;
    document.getElementById('p2NameDisplay').textContent = shortP2Name;
    
    document.getElementById('startScreen').classList.add('hidden');
    document.getElementById('gameScreen').classList.remove('hidden');
    document.getElementById('resultScreen').classList.add('hidden');
    document.getElementById('levelCongratsModal').classList.add('hidden');
    document.getElementById('applauseOverlay').classList.add('hidden');
    
    renderBoard();
    startTimer();
    
    document.getElementById('totalMatches').textContent = gameState.targetPairs;
    document.getElementById('totalMatches2').textContent = gameState.targetPairs;
    updateCompetitiveStatus();
  }

  function renderBoard() {
    const cards1 = generateCards();
    const cards2 = generateCards();
    
    gameState.player1Cards = cards1;
    gameState.player2Cards = cards2;
    
    document.getElementById('p1BoardName').textContent = gameState.players[0].name;
    document.getElementById('p2BoardName').textContent = gameState.players[1].name;
    
    renderPlayerBoard(1, cards1);
    renderPlayerBoard(2, cards2);
  }

  function renderPlayerBoard(playerNum, cards) {
    const board = document.getElementById(`gameBoard${playerNum}`);
    let cols, cardWidth, cardHeight;
    
    // Tentukan ukuran kartu berdasarkan difficulty
    switch(gameState.difficulty) {
      case 'easy':
        cols = 4;
        cardWidth = 'w-16';
        cardHeight = 'h-20';
        break;
      case 'medium':
        cols = 4;
        cardWidth = 'w-14';
        cardHeight = 'h-18';
        break;
      case 'hard':
        cols = 5;
        cardWidth = 'w-12';
        cardHeight = 'h-16';
        break;
      default:
        cols = 4;
        cardWidth = 'w-14';
        cardHeight = 'h-18';
    }
    
    board.style.gridTemplateColumns = `repeat(${cols}, minmax(0, 1fr))`;
    board.innerHTML = '';
    
    cards.forEach((card, index) => {
      const cardElement = document.createElement('div');
      cardElement.className = `card-flip ${cardWidth} ${cardHeight} cursor-pointer`;
      cardElement.id = `${playerNum}-${card.id}`;
      cardElement.onclick = () => flipCard(playerNum, index);
      
      const isOrgan = card.type === 'organ';
      const bgColor = isOrgan ? 'bg-gradient-to-br from-slate-700 to-slate-800' : `bg-gradient-to-br ${card.system.color}`;
      const cardFrontIcon = isOrgan ? '‚ùì' : card.system.cardFrontIcon || card.system.icon;
      
      // Potong teks jika terlalu panjang
      const displayText = isOrgan ? card.content.name : card.system.name;
      const shortText = displayText.length > 12 ? displayText.substring(0, 10) + ".." : displayText;
      
      cardElement.innerHTML = `
        <div class="card-inner">
          <div class="card-front bg-gradient-to-br from-indigo-600 to-purple-700 border border-white/20">
            <div class="card-content">
              <div class="card-icon">
                <span class="text-2xl">${cardFrontIcon}</span>
              </div>
            </div>
          </div>
          <div class="card-back ${bgColor} border border-white/30">
            <div class="card-content">
              <div class="card-icon mb-0.5">
                <span class="text-xl">${isOrgan ? card.content.icon : card.system.icon}</span>
              </div>
              <div class="card-text">
                <span class="text-[10px] leading-tight">${shortText}</span>
              </div>
            </div>
          </div>
        </div>
      `;
      
      board.appendChild(cardElement);
    });
  }

  function flipCard(playerNum, index) {
    const playerState = gameState[`player${playerNum}State`];
    
    if (playerState.isLocked) return;
    
    const cards = playerNum === 1 ? gameState.player1Cards : gameState.player2Cards;
    const card = cards[index];
    const cardElement = document.getElementById(`${playerNum}-${card.id}`);
    const cardInner = cardElement.querySelector('.card-inner');
    
    if (cardInner.classList.contains('flipped') || playerState.flippedCards.includes(index)) return;
    
    soundManager.playFlipSound();
    cardInner.classList.add('flipped');
    playerState.flippedCards.push(index);
    
    if (playerState.flippedCards.length === 2) {
      playerState.isLocked = true;
      setTimeout(() => checkMatch(playerNum), 500);
    }
  }

  function checkMatch(playerNum) {
    const playerState = gameState[`player${playerNum}State`];
    const [first, second] = playerState.flippedCards;
    const cards = playerNum === 1 ? gameState.player1Cards : gameState.player2Cards;
    const card1 = cards[first];
    const card2 = cards[second];
    
    const isMatch = card1.pairId === card2.pairId && card1.type !== card2.type;
    
    if (isMatch) {
      soundManager.playMatchSound();
      const organCard = card1.type === 'organ' ? card1 : card2;
      showInfo(`‚úÖ ${organCard.content.name}`);
      
      gameState.players[playerNum - 1].score++;
      playerState.matchedPairs++;
      
      const el1 = document.getElementById(`${playerNum}-${card1.id}`);
      const el2 = document.getElementById(`${playerNum}-${card2.id}`);
      
      if (el1) el1.classList.add('matched');
      if (el2) el2.classList.add('matched');
      
      setTimeout(() => {
        if (el1) el1.style.visibility = 'hidden';
        if (el2) el2.style.visibility = 'hidden';
        
        playerState.flippedCards = [];
        playerState.isLocked = false;
        
        updateScores();
        updateCompetitiveStatus();
        hideInfo();
        
        checkWinner();
      }, 800);
    } else {
      soundManager.playMissSound();
      showInfo(`‚ùå Salah`);
      
      setTimeout(() => {
        const el1 = document.getElementById(`${playerNum}-${card1.id}`);
        const el2 = document.getElementById(`${playerNum}-${card2.id}`);
        if (el1 && el2) {
          el1.querySelector('.card-inner').classList.remove('flipped');
          el2.querySelector('.card-inner').classList.remove('flipped');
        }
        
        playerState.flippedCards = [];
        playerState.isLocked = false;
        hideInfo();
      }, 800);
    }
  }

  function showInfo(text) {
    const panel = document.getElementById('infoPanel');
    const infoText = document.getElementById('infoText');
    infoText.textContent = text;
    panel.classList.remove('hidden');
    setTimeout(hideInfo, 1000);
  }

  function hideInfo() {
    document.getElementById('infoPanel').classList.add('hidden');
  }

  function updateScores() {
    document.getElementById('p1Score').textContent = gameState.players[0].score;
    document.getElementById('p2Score').textContent = gameState.players[1].score;
  }

  function startTimer() {
    if (gameState.timerInterval) clearInterval(gameState.timerInterval);
    
    gameState.timerInterval = setInterval(() => {
      gameState.timer++;
      const mins = Math.floor(gameState.timer / 60).toString().padStart(2, '0');
      const secs = (gameState.timer % 60).toString().padStart(2, '0');
      document.getElementById('timer').textContent = `${mins}:${secs}`;
    }, 1000);
  }

  function stopTimer() {
    if (gameState.timerInterval) {
      clearInterval(gameState.timerInterval);
      gameState.timerInterval = null;
    }
  }

  function updateCompetitiveStatus() {
    const total = gameState.targetPairs;
    const p1Percent = Math.round((gameState.player1State.matchedPairs / total) * 100);
    const p2Percent = Math.round((gameState.player2State.matchedPairs / total) * 100);
    
    document.getElementById('p1Matches').textContent = `${gameState.player1State.matchedPairs}/${total}`;
    document.getElementById('p2Matches').textContent = `${gameState.player2State.matchedPairs}/${total}`;
    
    document.getElementById('p1MatchBar').style.width = `${p1Percent}%`;
    document.getElementById('p2MatchBar').style.width = `${p2Percent}%`;
    
    const p1Card = document.getElementById('player1Card');
    const p2Card = document.getElementById('player2Card');
    
    if (gameState.player1State.matchedPairs > gameState.player2State.matchedPairs) {
      p1Card.classList.remove('opacity-60');
      p2Card.classList.add('opacity-60');
    } else if (gameState.player2State.matchedPairs > gameState.player1State.matchedPairs) {
      p2Card.classList.remove('opacity-60');
      p1Card.classList.add('opacity-60');
    } else {
      p1Card.classList.remove('opacity-60');
      p2Card.classList.remove('opacity-60');
    }
  }

  function checkWinner() {
    const p1Complete = gameState.player1State.matchedPairs >= gameState.targetPairs;
    const p2Complete = gameState.player2State.matchedPairs >= gameState.targetPairs;
    
    // Jika salah satu pemain menyelesaikan game
    if (p1Complete || p2Complete) {
      // Tentukan siapa yang pertama selesai
      let firstCompleterIndex;
      if (p1Complete && !p2Complete) {
        firstCompleterIndex = 0;
      } else if (p2Complete && !p1Complete) {
        firstCompleterIndex = 1;
      } else {
        // Jika keduanya selesai bersamaan, ambil yang memiliki skor lebih tinggi
        firstCompleterIndex = gameState.player1State.matchedPairs > gameState.player2State.matchedPairs ? 0 : 1;
      }
      
      // Tampilkan animasi applause untuk yang pertama selesai
      if (!gameState.firstLevelCompletion) {
        gameState.firstLevelCompletion = true;
        showApplause(gameState.players[firstCompleterIndex].name);
        
        // Tampilkan animasi level congratulation setelah applause
        setTimeout(() => {
          showLevelCongrats(gameState.players[firstCompleterIndex].name);
        }, 3200);
      }
      
      // Setelah semua animasi selesai, tampilkan hasil
      setTimeout(() => {
        stopTimer();
        
        // Determine final winner
        let winnerIndex;
        if (p1Complete && !p2Complete) {
          winnerIndex = 0;
        } else if (p2Complete && !p1Complete) {
          winnerIndex = 1;
        } else {
          // Both complete, check scores
          winnerIndex = gameState.player1State.matchedPairs > gameState.player2State.matchedPairs ? 0 : 1;
        }
        
        // Disable all card clicks
        const board1 = document.getElementById('gameBoard1');
        const board2 = document.getElementById('gameBoard2');
        if (board1) {
          board1.style.pointerEvents = 'none';
          board1.style.opacity = '0.5';
        }
        if (board2) {
          board2.style.pointerEvents = 'none';
          board2.style.opacity = '0.5';
        }
        
        // Show results after a short delay
        setTimeout(() => showResults(winnerIndex), 500);
      }, 6000); // Tunggu semua animasi selesai
    }
  }

  function showResults(winnerIndex) {
    soundManager.playWinSound();
    const winner = gameState.players[winnerIndex];
    const diffText = gameState.difficulty === 'easy' ? 'Mudah' : gameState.difficulty === 'medium' ? 'Sedang' : 'Sulit';
    
    document.getElementById('gameScreen').classList.add('hidden');
    document.getElementById('resultScreen').classList.remove('hidden');
    
    // Set winner announcement
    document.getElementById('winnerMessageLevel').textContent = `${winner.name} menang di level ${diffText}!`;
    document.getElementById('winnerName').textContent = `${winner.name} Juara!`;
    document.getElementById('result1Name').textContent = gameState.players[0].name;
    document.getElementById('result1Score').textContent = `${gameState.players[0].score} pasang`;
    document.getElementById('result2Name').textContent = gameState.players[1].name;
    document.getElementById('result2Score').textContent = `${gameState.players[1].score} pasang`;
    
    const mins = Math.floor(gameState.timer / 60).toString().padStart(2, '0');
    const secs = (gameState.timer % 60).toString().padStart(2, '0');
    document.getElementById('resultTime').textContent = `${mins}:${secs}`;
    document.getElementById('resultDifficulty').textContent = diffText;
    
    createConfetti();
  }

  function createConfetti() {
    const container = document.getElementById('confettiContainer');
    container.innerHTML = '';
    
    const colors = ['#ff6b6b', '#4ecdc4', '#f9ca24', '#6c5ce7', '#fd79a8'];
    
    for (let i = 0; i < 25; i++) {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.left = `${Math.random() * 100}%`;
      confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
      confetti.style.animationDelay = `${Math.random() * 1.5}s`;
      confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
      container.appendChild(confetti);
    }
  }

  function restartGame() {
    startGame();
  }

  function backToMenu() {
    soundManager.playButtonClick();
    stopTimer();
    document.getElementById('startScreen').classList.remove('hidden');
    document.getElementById('gameScreen').classList.add('hidden');
    document.getElementById('resultScreen').classList.add('hidden');
    document.getElementById('levelCongratsModal').classList.add('hidden');
    document.getElementById('applauseOverlay').classList.add('hidden');
    
    gameState.difficulty = null;
    document.querySelectorAll('.difficulty-btn').forEach(btn => {
      btn.classList.remove('ring-1', 'ring-white');
    });
  }
</script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cb0d1cb220e14a6',t:'MTc3MDYxMzM5OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
</body>
</html>
